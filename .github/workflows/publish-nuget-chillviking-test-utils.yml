name: publish ChillViking.TestUtils.NUnit
on:
  push:
    branches: [ main ]
    tags:
    - 'nuget-test-utils-nunit'
    - 'v*'

jobs:
  publish:
    name: test, build, pack & publish
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: nuget/ChillViking.TestUtils
    steps:
    - name: 'Checkout'
      uses: actions/checkout@v2

    - name: 'Test ChillViking.TestUtils.NUnit'
      run: dotnet test ./ChillViking.TestUtils.NUnit.Tests/ChillViking.TestUtils.NUnit.Tests.csproj

    - name: 'Get Version'
      id: version
      uses: battila7/get-version-action@v2

    - name: publish on version change
      id: publish_nuget
      uses: brandedoutcast/publish-nuget@v2
      with:
        PROJECT_FILE_PATH: ChillViking.TestUtils.NUnit/ChillViking.TestUtils.NUnit.csproj
        NUGET_KEY: ${{secrets.NUGET_API_KEY}}
        BUILD_CONFIGURATION: Release
        VERSION_STATIC: ${{steps.version.outputs.version-without-v}}
        INCLUDE_SYMBOLS: false
